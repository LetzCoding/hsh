#!/bin/sh
echo "HSH Configure Utility.\n"

# check for some utilities
echo "Checking for some shell utils..."
if touch testFile.c; then
	if rm -rf testFile.c; then
		if mkdir aaa; then
			if rmdir aaa; then
				if cp main.c main.c.copy; then
					rm main.c.copy
				fi
			fi
		fi
	fi
fi

# check for C compiler
echo "Checking for a compiler..."
echo "int main() {return 0;}" > testFile.c
compiler=""
if gcc testFile.c -o a; then
	compiler="gcc"
elif clang testFile.c -o a; then
	compiler="clang"
else
	echo "Sorry, you need GNU C compiler or CLANG compiler to compile HSH \nand it must be in the directory which is in PATH."
	exit 1
fi
rm a

# show the results
echo "\nThis is the result table of the Makefile:"
echo "Compiler: $compiler"

# make Makefile
echo "\nGenerating Makefile..."
cat << EOF > Makefile 
# Makefile generated by HSH configure utility
helpdir="/usr/share/hsh/help"
hshdir="/usr/share/hsh"
CC="$compiler"
install:
	make compile
	make config
compile: main.c
	\$(CC) main.c -static -g -o hsh
config: ../help/*
	rm -rf \$(hshdir)
	mkdir \$(hshdir)
	rm -rf \$(helpdir)
	mkdir \$(helpdir)
	cp ../help/*.help \$(helpdir)
	cp gpl.txt \$(hshdir)

EOF
echo 'Generating done. Type "sudo make" to compile.'

